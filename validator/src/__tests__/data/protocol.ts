import type { Address, Hex } from "viem";
import { entryPoint06Address, entryPoint07Address } from "viem/account-abstraction";
import { BaseProtocol } from "../../consensus/protocol/base.js";
import type { EthTransactionData } from "../../consensus/protocol/onchain.js";
import type {
	AttestTransaction,
	Complain,
	ComplaintResponse,
	ConfirmKeyGen,
	ProtocolAction,
	PublishSecretShares,
	PublishSignatureShare,
	RegisterNonceCommitments,
	RequestSignature,
	RevealNonceCommitments,
	StageEpoch,
	StartKeyGen,
} from "../../consensus/protocol/types.js";
import { toPoint } from "../../frost/math.js";

export class TestProtocol extends BaseProtocol {
	chainId(): bigint {
		throw new Error("Method not implemented.");
	}
	consensus(): Address {
		throw new Error("Method not implemented.");
	}
	coordinator(): Address {
		throw new Error("Method not implemented.");
	}
	public startKeyGen(_args: StartKeyGen): Promise<Hex> {
		throw new Error("Method not implemented.");
	}
	public publishKeygenSecretShares(_args: PublishSecretShares): Promise<Hex> {
		throw new Error("Method not implemented.");
	}
	public complain(_args: Complain): Promise<Hex> {
		throw new Error("Method not implemented.");
	}
	public complaintResponse(_args: ComplaintResponse): Promise<Hex> {
		throw new Error("Method not implemented.");
	}
	public confirmKeyGen(_args: ConfirmKeyGen): Promise<Hex> {
		throw new Error("Method not implemented.");
	}
	public requestSignature(_args: RequestSignature): Promise<Hex> {
		throw new Error("Method not implemented.");
	}
	public registerNonceCommitments(_args: RegisterNonceCommitments): Promise<Hex> {
		throw new Error("Method not implemented.");
	}
	public revealNonceCommitments(_args: RevealNonceCommitments): Promise<Hex> {
		throw new Error("Method not implemented.");
	}
	public publishSignatureShare(_args: PublishSignatureShare): Promise<Hex> {
		throw new Error("Method not implemented.");
	}
	public attestTransaction(_args: AttestTransaction): Promise<Hex> {
		throw new Error("Method not implemented.");
	}
	public stageEpoch(_args: StageEpoch): Promise<Hex> {
		throw new Error("Method not implemented.");
	}
}

export const TEST_POINT = toPoint({
	x: 105587021125387004117772930966558154492652686110919450580386247155506502192059n,
	y: 97790146336079427917878178932139533907352200097479391118658154349645214584696n,
});

export const TEST_CONSENSUS = entryPoint06Address;
export const TEST_COORDINATOR = entryPoint07Address;

export const TEST_ACTIONS: [ProtocolAction, keyof TestProtocol, EthTransactionData][] = [
	[
		{
			id: "sign_request",
			groupId: "0x5afe000000000000000000000000000000000000000000000000000000000000",
			message: "0x5afe5afe00000000000000000000000000000000000000000000000000000000",
		},
		"requestSignature",
		{
			to: TEST_COORDINATOR,
			value: 0n,
			data: "0x86f576355afe0000000000000000000000000000000000000000000000000000000000005afe5afe00000000000000000000000000000000000000000000000000000000",
			gas: undefined,
		},
	],
	[
		{
			id: "sign_register_nonce_commitments",
			groupId: "0x5afe000000000000000000000000000000000000000000000000000000000000",
			nonceCommitmentsHash: "0x5afe5afe00000000000000000000000000000000000000000000000000000000",
		},
		"registerNonceCommitments",
		{
			to: TEST_COORDINATOR,
			value: 0n,
			data: "0x42b29c615afe0000000000000000000000000000000000000000000000000000000000005afe5afe00000000000000000000000000000000000000000000000000000000",
			gas: undefined,
		},
	],
	[
		{
			id: "sign_reveal_nonce_commitments",
			signatureId: "0x5afe000000000000000000000000000000000000000000000000000000000000",
			nonceCommitments: {
				bindingNonceCommitment: TEST_POINT,
				hidingNonceCommitment: TEST_POINT,
			},
			nonceProof: [
				"0x5afe010000000000000000000000000000000000000000000000000000000000",
				"0x5afe020000000000000000000000000000000000000000000000000000000000",
			],
		},
		"revealNonceCommitments",
		{
			to: TEST_COORDINATOR,
			value: 0n,
			data: "0x527bdde95afe000000000000000000000000000000000000000000000000000000000000e97022d9e91554adbaecc6738ac72daa9710672694aafb09f18d485bcaa04bbbd83342eaaa01aefa449e9061a287f3bf39739fcfaeae8a7a13f507215a010f78e97022d9e91554adbaecc6738ac72daa9710672694aafb09f18d485bcaa04bbbd83342eaaa01aefa449e9061a287f3bf39739fcfaeae8a7a13f507215a010f7800000000000000000000000000000000000000000000000000000000000000c000000000000000000000000000000000000000000000000000000000000000025afe0100000000000000000000000000000000000000000000000000000000005afe020000000000000000000000000000000000000000000000000000000000",
			gas: undefined,
		},
	],
	[
		{
			id: "sign_publish_signature_share",
			signatureId: "0x5afe000000000000000000000000000000000000000000000000000000000000",
			signersRoot: "0x5afe000000000000000000000000000000000000000000000000000000000000",
			signersProof: [
				"0x5afe010000000000000000000000000000000000000000000000000000000000",
				"0x5afe020000000000000000000000000000000000000000000000000000000000",
			],
			groupCommitment: TEST_POINT,
			commitmentShare: TEST_POINT,
			signatureShare: 1n,
			lagrangeCoefficient: 2n,
		},
		"publishSignatureShare",
		{
			to: TEST_COORDINATOR,
			value: 0n,
			data: "0x243e8b835afe000000000000000000000000000000000000000000000000000000000000e97022d9e91554adbaecc6738ac72daa9710672694aafb09f18d485bcaa04bbbd83342eaaa01aefa449e9061a287f3bf39739fcfaeae8a7a13f507215a010f785afe000000000000000000000000000000000000000000000000000000000000e97022d9e91554adbaecc6738ac72daa9710672694aafb09f18d485bcaa04bbbd83342eaaa01aefa449e9061a287f3bf39739fcfaeae8a7a13f507215a010f7800000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000012000000000000000000000000000000000000000000000000000000000000000025afe0100000000000000000000000000000000000000000000000000000000005afe020000000000000000000000000000000000000000000000000000000000",
			gas: 400_000n,
		},
	],
	[
		{
			id: "sign_publish_signature_share",
			signatureId: "0x5afe000000000000000000000000000000000000000000000000000000000000",
			signersRoot: "0x5afe000000000000000000000000000000000000000000000000000000000000",
			signersProof: [
				"0x5afe010000000000000000000000000000000000000000000000000000000000",
				"0x5afe020000000000000000000000000000000000000000000000000000000000",
			],
			groupCommitment: TEST_POINT,
			commitmentShare: TEST_POINT,
			signatureShare: 1n,
			lagrangeCoefficient: 2n,
			callbackContext: "0x5afe00aa00000000000000000000000000000000000000000000000000000000",
		},
		"publishSignatureShare",
		{
			to: TEST_COORDINATOR,
			value: 0n,
			data: "0x95b57d9d5afe000000000000000000000000000000000000000000000000000000000000e97022d9e91554adbaecc6738ac72daa9710672694aafb09f18d485bcaa04bbbd83342eaaa01aefa449e9061a287f3bf39739fcfaeae8a7a13f507215a010f785afe000000000000000000000000000000000000000000000000000000000000e97022d9e91554adbaecc6738ac72daa9710672694aafb09f18d485bcaa04bbbd83342eaaa01aefa449e9061a287f3bf39739fcfaeae8a7a13f507215a010f7800000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000014000000000000000000000000000000000000000000000000000000000000001a000000000000000000000000000000000000000000000000000000000000000025afe0100000000000000000000000000000000000000000000000000000000005afe0200000000000000000000000000000000000000000000000000000000000000000000000000000000005ff137d4b0fdcd49dca30c7cf57e578a026d2789000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000205afe00aa00000000000000000000000000000000000000000000000000000000",
			gas: 400_000n,
		},
	],
	[
		{
			id: "key_gen_start",
			participants: "0x5afe000000000000000000000000000000000000000000000000000000000000",
			count: 4,
			threshold: 3,
			context: "0x5afe00aa00000000000000000000000000000000000000000000000000000000",
			participantId: 1n,
			commitments: [TEST_POINT, TEST_POINT],
			pok: {
				r: TEST_POINT,
				mu: 5n,
			},
			poap: [
				"0x5afe010000000000000000000000000000000000000000000000000000000000",
				"0x5afe020000000000000000000000000000000000000000000000000000000000",
			],
		},
		"startKeyGen",
		{
			to: TEST_COORDINATOR,
			value: 0n,
			data: "0x4a53702c5afe000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000035afe00aa00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000e0000000000000000000000000000000000000000000000000000000000000014000000000000000000000000000000000000000000000000000000000000000025afe0100000000000000000000000000000000000000000000000000000000005afe0200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000080e97022d9e91554adbaecc6738ac72daa9710672694aafb09f18d485bcaa04bbbd83342eaaa01aefa449e9061a287f3bf39739fcfaeae8a7a13f507215a010f7800000000000000000000000000000000000000000000000000000000000000050000000000000000000000000000000000000000000000000000000000000002e97022d9e91554adbaecc6738ac72daa9710672694aafb09f18d485bcaa04bbbd83342eaaa01aefa449e9061a287f3bf39739fcfaeae8a7a13f507215a010f78e97022d9e91554adbaecc6738ac72daa9710672694aafb09f18d485bcaa04bbbd83342eaaa01aefa449e9061a287f3bf39739fcfaeae8a7a13f507215a010f78",
			gas: 250_000n,
		},
	],
	[
		{
			id: "key_gen_publish_secret_shares",
			groupId: "0x5afe000000000000000000000000000000000000000000000000000000000000",
			verificationShare: TEST_POINT,
			shares: [1n, 2n, 3n, 5n, 8n, 13n],
		},
		"publishKeygenSecretShares",
		{
			to: TEST_COORDINATOR,
			value: 0n,
			data: "0x7d10c04b5afe0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040e97022d9e91554adbaecc6738ac72daa9710672694aafb09f18d485bcaa04bbbd83342eaaa01aefa449e9061a287f3bf39739fcfaeae8a7a13f507215a010f780000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000300000000000000000000000000000000000000000000000000000000000000050000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000d",
			gas: 350_000n,
		},
	],
	[
		{
			id: "key_gen_complain",
			groupId: "0x5afe000000000000000000000000000000000000000000000000000000000000",
			accused: 1n,
		},
		"complain",
		{
			to: TEST_COORDINATOR,
			value: 0n,
			data: "0x0b2b35375afe0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001",
			gas: undefined,
		},
	],
	[
		{
			id: "key_gen_complaint_response",
			groupId: "0x5afe000000000000000000000000000000000000000000000000000000000000",
			plaintiff: 2n,
			secretShare: 0x5afe5afe5afen,
		},
		"complaintResponse",
		{
			to: TEST_COORDINATOR,
			value: 0n,
			data: "0x01b443335afe000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000005afe5afe5afe",
			gas: undefined,
		},
	],
	[
		{
			id: "key_gen_confirm",
			groupId: "0x5afe000000000000000000000000000000000000000000000000000000000000",
		},
		"confirmKeyGen",
		{
			to: TEST_COORDINATOR,
			value: 0n,
			data: "0x1169f60e5afe000000000000000000000000000000000000000000000000000000000000",
			gas: 100_000n,
		},
	],
	[
		{
			id: "key_gen_confirm",
			groupId: "0x5afe000000000000000000000000000000000000000000000000000000000000",
			callbackContext: "0x5afe00aa00000000000000000000000000000000000000000000000000000000",
		},
		"confirmKeyGen",
		{
			to: TEST_COORDINATOR,
			value: 0n,
			data: "0x1896ae365afe00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000005ff137d4b0fdcd49dca30c7cf57e578a026d2789000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000205afe00aa00000000000000000000000000000000000000000000000000000000",
			gas: 300_000n,
		},
	],
	[
		{
			id: "consensus_attest_transaction",
			epoch: 10n,
			transactionHash: "0x5afe00aa00000000000000000000000000000000000000000000000000000000",
			signatureId: "0x5afe000000000000000000000000000000000000000000000000000000000000",
		},
		"attestTransaction",
		{
			to: TEST_CONSENSUS,
			value: 0n,
			data: "0x68c0ce39000000000000000000000000000000000000000000000000000000000000000a5afe00aa000000000000000000000000000000000000000000000000000000005afe000000000000000000000000000000000000000000000000000000000000",
			gas: undefined,
		},
	],
	[
		{
			id: "consensus_stage_epoch",
			proposedEpoch: 10n,
			rolloverBlock: 30n,
			groupId: "0x5afe00aa00000000000000000000000000000000000000000000000000000000",
			signatureId: "0x5afe000000000000000000000000000000000000000000000000000000000000",
		},
		"stageEpoch",
		{
			to: TEST_CONSENSUS,
			value: 0n,
			data: "0xea5eeafa000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000001e5afe00aa000000000000000000000000000000000000000000000000000000005afe000000000000000000000000000000000000000000000000000000000000",
			gas: undefined,
		},
	],
];
